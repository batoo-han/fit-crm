"""Initialize default sales scenarios."""
from database.db import get_db_session
from database.models_crm import SalesScenario
from loguru import logger
import json


def create_default_sales_scenarios():
    """Create default sales scenarios."""
    db = get_db_session()
    try:
        # Check if scenarios already exist
        existing = db.query(SalesScenario).count()
        if existing > 0:
            logger.info("Sales scenarios already exist, skipping creation")
            return
        
        scenarios = [
            {
                "name": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã",
                "description": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –Ω–µ–¥–µ–ª–∏",
                "trigger_type": "pipeline_stage",
                "trigger_conditions": {
                    "pipeline_stage": "–ü—Ä–∏–Ω–∏–º–∞—é—Ç —Ä–µ—à–µ–Ω–∏–µ",
                    "has_free_program": True
                },
                "message_template": """–ü—Ä–∏–≤–µ—Ç, {name}! 

–Ø –≤–∏–∂—É, —á—Ç–æ —Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É. –ö–∞–∫ —Ç–µ–±–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏? 

üí™ –î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–æ–ª–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å:
‚Ä¢ –ü–æ–ª–Ω—ã–º –ø–ª–∞–Ω–æ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω—ã–º –ø–ª–∞–Ω–æ–º –ø–∏—Ç–∞–Ω–∏—è —Å —Ä–∞—Å—á–µ—Ç–æ–º –ö–ë–ñ–£
‚Ä¢ –û–Ω–ª–∞–π–Ω-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ç–µ—Ö–Ω–∏–∫–∏
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Ç–µ–±–µ –¥–æ—Å—Ç–∏—á—å —Ç–≤–æ–∏—Ö —Ü–µ–ª–µ–π! üéØ""",
                "action_type": "suggest_program",
                "priority": 10
            },
            {
                "name": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤",
                "description": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤",
                "trigger_type": "client_action",
                "trigger_conditions": {
                    "experience_level": "–Ω–æ–≤–∏—á–æ–∫"
                },
                "message_template": """–ü—Ä–∏–≤–µ—Ç, {name}! 

–Ø –≤–∏–∂—É, —á—Ç–æ —Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å —Å–≤–æ–π –ø—É—Ç—å –∫ –∑–¥–æ—Ä–æ–≤–æ–º—É –æ–±—Ä–∞–∑—É –∂–∏–∑–Ω–∏. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–æ! 

üí™ –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∞—Ç—å —Å –º–µ—Å—è—á–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã:
‚Ä¢ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
‚Ä¢ –û–±—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–µ
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
‚Ä¢ –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫

–ü–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–∞—á–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫! üéØ""",
                "action_type": "suggest_program",
                "priority": 8
            },
            {
                "name": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è",
                "description": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Ü–µ–ª—å—é –ø–æ—Ö—É–¥–µ–Ω–∏—è",
                "trigger_type": "client_action",
                "trigger_conditions": {
                    "fitness_goals": ["–ø–æ—Ö—É–¥–µ–Ω–∏–µ", "—Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞"]
                },
                "message_template": """–ü—Ä–∏–≤–µ—Ç, {name}! 

–Ø –≤–∏–∂—É, —á—Ç–æ —Ç–≤–æ—è —Ü–µ–ª—å - {fitness_goals}. –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! 

üí™ –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ—Ö—É–¥–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Ç—Ä–µ—Ö–º–µ—Å—è—á–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É:
‚Ä¢ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∫–∞—Ä–¥–∏–æ –∏ —Å–∏–ª–æ–≤—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è —Å –¥–µ—Ñ–∏—Ü–∏—Ç–æ–º –∫–∞–ª–æ—Ä–∏–π
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã
‚Ä¢ –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –∑–∞—Å—Ç–∞–≤—è—Ç —Å–µ–±—è –∂–¥–∞—Ç—å! üéØ""",
                "action_type": "suggest_program",
                "priority": 9
            },
            {
                "name": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –Ω–∞–±–æ—Ä–∞ –º–∞—Å—Å—ã",
                "description": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Ü–µ–ª—å—é –Ω–∞–±–æ—Ä–∞ –º–∞—Å—Å—ã",
                "trigger_type": "client_action",
                "trigger_conditions": {
                    "fitness_goals": ["–Ω–∞–±–æ—Ä –º–∞—Å—Å—ã", "–º–∞—Å—Å–∞"]
                },
                "message_template": """–ü—Ä–∏–≤–µ—Ç, {name}! 

–Ø –≤–∏–∂—É, —á—Ç–æ —Ç–≤–æ—è —Ü–µ–ª—å - {fitness_goals}. –û—Ç–ª–∏—á–Ω–æ! 

üí™ –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Ç—Ä–µ—Ö–º–µ—Å—è—á–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É:
‚Ä¢ –ë–∞–∑–æ–≤—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–µ–π –Ω–∞–≥—Ä—É–∑–æ–∫
‚Ä¢ –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è —Å –ø—Ä–æ—Ñ–∏—Ü–∏—Ç–æ–º –∫–∞–ª–æ—Ä–∏–π
‚Ä¢ –§–æ–∫—É—Å –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–µ
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã

–ü–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–∞–±—Ä–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –º–∞—Å—Å—É! üéØ""",
                "action_type": "suggest_program",
                "priority": 9
            },
            {
                "name": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º —Å–æ –∑–¥–æ—Ä–æ–≤—å–µ–º",
                "description": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é",
                "trigger_type": "client_action",
                "trigger_conditions": {
                    "health_restrictions": "not_null"  # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
                },
                "message_template": """–ü—Ä–∏–≤–µ—Ç, {name}! 

–Ø –≤–∏–∂—É, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é. –≠—Ç–æ –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

üè• –†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∞—Ç—å —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
‚Ä¢ –û–±—Å—É–¥–∏–º —Ç–≤–æ–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
‚Ä¢ –ü–æ–¥–±–µ—Ä–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
‚Ä¢ –°–æ—Å—Ç–∞–≤–∏–º –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —É—á–µ—Ç–æ–º —Ç–≤–æ–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π
‚Ä¢ –ü—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ–º—Å—è —Å –≤—Ä–∞—á–æ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

–ó–¥–æ—Ä–æ–≤—å–µ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ! –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ. üí™""",
                "action_type": "suggest_consultation",
                "priority": 10
            },
        ]
        
        for scenario_data in scenarios:
            scenario = SalesScenario(
                name=scenario_data["name"],
                description=scenario_data["description"],
                trigger_type=scenario_data["trigger_type"],
                trigger_conditions=json.dumps(scenario_data["trigger_conditions"]),
                message_template=scenario_data["message_template"],
                action_type=scenario_data["action_type"],
                is_active=True,
                priority=scenario_data["priority"]
            )
            db.add(scenario)
        
        db.commit()
        logger.info(f"Created {len(scenarios)} default sales scenarios")
    except Exception as e:
        logger.error(f"Error creating default sales scenarios: {e}")
        db.rollback()
    finally:
        db.close()


if __name__ == "__main__":
    create_default_sales_scenarios()


