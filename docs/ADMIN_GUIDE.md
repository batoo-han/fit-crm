# Руководство администратора (CRM и сайт)

Этот документ предназначен для сотрудников, управляющих CRM, сайтом, чат-виджетом и коммуникациями с клиентами.

## 1. Доступ и роли

- **Админ-панель (React CRM)** доступна по `https://<ваш_домен>/` (в продакшене). Логин/пароль — уточните у технического администратора.
- **API** доступен по `https://<ваш_домен>/api`. Прямой доступ нужен только техподдержке.
- **Telegram-бот** управляется через файл `.env` (токен) и запуск `bot.py` (для локальных сценариев).
- **Сайт (`dnk/`)** разворачивается отдельно, но настройки контента/стилей применяются через админку.

## 2. Навигация по CRM

Главные разделы панели:

- **Главная / Дашборд** — сводная аналитика, ключевые метрики.
- **Клиенты** — список клиентов, фильтры, карточки.
- **Программы тренировок** — библиотека программ, генератор демо-версий.
- **Воронка** — этапы продаж, канбан, действия.
- **Аналитика** — графики, отчёты (доходы, конверсии).
- **Настройки сайта** — контент сайта, стили, виджет чата, контакты.
- **Настройки (общие)** — системные параметры, интеграции (по мере внедрения).

## 3. Управление клиентами

### 3.1 Добавление / импорт
- Новые клиенты создаются автоматически при отправке формы на сайте или вручную через кнопку «Добавить клиента».
- При создании укажите контактные данные, статус, источник, интересы.

### 3.2 Карточка клиента
- Раздел «Информация» — базовые данные (имя, контакты, цели).
- «Действия» — журнал взаимодействий (звонки, письма, чат).
- «Программы» — активные и завершённые тренировочные планы.
- «Платежи» — история оплат, задолженности.
- «Журнал прогресса» — записи о результатах, замерах, комментариях тренера.

### 3.3 Удаление клиента
- Доступно из карточки (кнопка «Удалить клиента»).
- При удалении автоматически очищаются связанные записи: платежи, действия, программы, контакты, прогресс.
- Внимание: операция необратима. Перед удалением сохраните важные данные (например, экспорт в CSV).

## 4. Воронка продаж

- Этапы управляются на странице **Настройки сайта → Воронка** (если включено).
- В таблице клиентов используйте кнопки «Изменить этап» → «Сохранить» для фиксации.
- Автоматические стадии:
  - «Первичный контакт» — выставляется при заявке с сайта или обращения из чата.
  - «Квалификация» — когда менеджер подтверждает запрос.
  - «Оплата» — после проведения платежа.
- Добавляйте комментарии и действия, чтобы отслеживать историю.

## 5. Управление программами

### 5.1 Каталог программ
- Используйте раздел **Программы тренировок**.
- Каждая программа содержит описание, длительность, стоимость, набор недель.
- Изменяйте упражнения, схемы, рекомендации через редактор.

### 5.2 Демо-программы
- Тип `free_demo` генерирует только первую неделю (реализовано в `services/program_storage.py`).
- Проверьте содержимое перед отправкой клиенту.

### 5.3 Выдача программ
- Программы назначаются из карточки клиента. Выберите программу, даты и условия.
- Клиент получает уведомление (при подключении Telegram/Email).

## 6. Платежи и финансы

- Раздел **Платежи** (если включено) показывает оплаченные и ожидающие транзакции.
- При импорте данных указывайте:
  - Сумму.
  - Валюту.
  - Дату.
  - Статус («Оплачено», «Ожидает», «Возврат»).
- Удаление платежа возможно только при наличии прав администратора.

## 7. Настройки сайта

### 7.1 Общие
- Раздел **Настройки сайта → Общие**:
  - Название, описание, контакты (email, телефон, мессенджеры).
  - Ссылки на соцсети, CTA-кнопки.

### 7.2 Шапка и подвал
- Изменяйте меню, лозунги, иконки, CTA-кнопки.
- Описание услуг, блок преимуществ, отзывы.

### 7.3 Цвета и шрифты
- Основные цвета (фон, акценты, текст).
- Семейства и размеры шрифтов.
- После изменений нажмите «Сохранить все» в верхней части страницы.

### 7.4 Чат-виджет
- **Заголовок, логотип, приветствие** — тексты, которые видит пользователь.
- **Позиция и цвета** — настройте внешний вид, чтобы не перекрывать кнопку «Связаться».
- **Поведение** — автооткрытие, задержки, память сеанса.
- **LLM настройки**:
  - Провайдер: Yandex GPT / OpenAI / ProxyAPI.
  - Модель: список доступных моделей зависит от провайдера.
  - Температура, макс. токены, системный промпт.
  - Если выставлена несовместимая модель (например, GPT-4 для Yandex) — система автоматически заменит на корректную.
- **Системный промпт** — задаёт тон общения ассистента. Включите инструкции по бренду, манере общения, алгоритм опроса клиента.

## 8. Обработка обращений с сайта

- Заявки сохраняются в таблицу `website_contacts` и привязываются к клиентам по email/телефону.
- Если клиент новый — создаётся запись в CRM, этап «Первичный контакт».
- Создаются действия (`client_actions`) и контакты (`client_contacts`) с типом «website».
- Администратору отправляется Telegram-уведомление.
- Проверяйте новые обращения в разделе **Клиенты → Фильтр “Новые”**.

## 9. LLM и чат-бот

- Все настройки виджета управляются из админки, хранение в таблице `website_settings`.
- Для тестирования изменений используйте предпросмотр на staging/локальной копии (не на продакшене).
- Храните ключи API в `.env` и обновляйте при ротации.
- Отслеживайте расходы и лимиты LLM (особенно OpenAI/ProxyAPI).

## 10. Telegram-бот

- Запуск: `python bot.py` (или через systemd/service на сервере).
- Логи — `logs/bot.log`.
- Команды администратора:
  - `/stats` — статистика по боту.
  - `/broadcast` (если реализовано) — массовая рассылка (используйте осмотрительно).
- Обновление токена: измените `TELEGRAM_BOT_TOKEN` в `.env`, перезапустите процесс.

## 11. Резервное копирование и безопасность

- **База данных**: регулярно копируйте `crm.db` (см. `SETUP_GUIDE.md`). Храните архивы на безопасном носителе.
- **Логи**: очищайте каталоги `logs/`, если занимают много места.
- **Доступы**: храните `.env` и ключи LLM в защищённом месте, ограничьте доступ к серверу.
- **Обновления**: тестируйте правки на staging перед выкатыванием.
- **HTTPS**: обеспечьте сертификаты для домена (Let's Encrypt / Cloudflare).

## 12. Регулярные задачи администратора

- Ежедневно:
  - Проверять новые заявки и сообщения из чата.
  - Контролировать этапы воронки.
  - Обновлять статусы клиентов после созвонов/тренировок.
- Еженедельно:
  - Анализировать отчёты в разделе «Аналитика».
  - обновлять контент сайта (акции, новости).
  - Проверять корректность работы LLM (просмотр логов, обратная связь от клиентов).
- Ежемесячно:
  - Резервное копирование базы данных.
  - Ротация ключей (при необходимости).
  - Обновление программ и тарифов.

## 13. Обратная связь и эскалация

- Технические проблемы (ошибки, сбои сервера) — сообщайте разработчику/DevOps (контакты в `.env` или отдельном документе).
- Бизнес-вопросы и правки контента — обсуждайте с владельцем бренда (Данила Цыганков).
- Предложения по улучшениям фиксируйте в таск-трекере или `PROJECT_STATUS.md`.

---

При работе внимательно следите за корректностью данных и записей клиентов — CRM является единым источником правды для команды.

