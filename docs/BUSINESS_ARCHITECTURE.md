# Бизнес-архитектура процесса продаж фитнес-тренировок

## Обзор

Данный документ описывает полную бизнес-архитектуру автоматизированной системы продаж фитнес-тренировок, включая все этапы от привлечения клиента до завершения работы, взаимодействие компонентов системы, потоки данных и автоматизации.

---

## Общая схема бизнес-процесса

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ЭТАП 1: ПРИВЛЕЧЕНИЕ (TOFU)                            │
│                     Каналы привлечения клиентов                              │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────┐      ┌─────────────┐      ┌─────────────┐      ┌─────────────┐
    │  Соцсети    │      │    Сайт     │      │ Рекомендации│      │  Прямые     │
    │             │      │             │      │    друзей   │      │   лиды      │
    │ Telegram    │      │ batoohan.ru │      │             │      │             │
    │    VK       │      │             │      │             │      │             │
    │ Instagram   │      │             │      │             │      │             │
    └──────┬──────┘      └──────┬──────┘      └──────┬──────┘      └──────┬──────┘
           │                    │                    │                    │
           │                    │                    │                    │
           └────────────────────┴────────────────────┴────────────────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │   Призыв к действию   │
                    │  "Получить программу" │
                    └───────────┬───────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│              ЭТАП 2: КВАЛИФИКАЦИЯ И ВЫДАЧА ЦЕННОСТИ (MOFU)                   │
│                    Telegram-бот как основной touchpoint                      │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────────┐
                    │  Запуск бота (/start) │
                    │  Первичный контакт    │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │   Главное меню бота   │
                    │  - Бесплатная програма│
                    │  - Цены и тарифы      │
                    │  - FAQ                │
                    │  - Контакты           │
                    └───────────┬───────────┘
                                │
                                ▼ (Выбор: "Получить программу")
                    ┌───────────────────────┐
                    │   Квалификационный    │
                    │      опросник         │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Сбор данных клиента  │
                    │  - Пол                │
                    │  - Возраст            │
                    │  - Опыт тренировок    │
                    │  - Цель               │
                    │  - Рост/вес           │
                    │  - Образ жизни        │
                    │  - Локация тренировок │
                    │  - Оборудование       │
                    └───────────┬───────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │  Сохранение в CRM     │
                    │  - Создание Client    │
                    │  - Создание Lead      │
                    │  - Статус: qualified  │
                    │  - Этап: "Консультация"│
                    └───────────┬───────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │ Генерация программы   │
                    │  - Поиск в Google     │
                    │    Sheets по параметрам│
                    │  - Форматирование     │
                    │    через LLM          │
                    │  - Создание PDF       │
                    └───────────┬───────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │  Выдача бесплатной    │
                    │   программы клиенту   │
                    │  (PDF в Telegram)     │
                    └───────────┬───────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │  Призыв к конверсии   │
                    │  - Показ тарифов      │
                    │  - Кнопка "Купить"    │
                    └───────────┬───────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│              ЭТАП 3: КОНВЕРСИЯ В ОПЛАТУ (BOFU)                               │
│                    Продажа платных услуг                                     │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────────┐
                    │  Клиент выбирает      │
                    │  тариф/услугу         │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Вариант 1: Через    │
                    │  Telegram-бота       │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Вариант 2: Через     │
                    │  сайт (онлайн-оплата) │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Создание платежа     │
                    │  - Payment record     │
                    │  - Статус: pending    │
                    │  - Связь с клиентом   │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Инициация платежа    │
                    │  YooKassa/Tinkoff     │
                    │  - Создание сессии    │
                    │  - Ссылка на оплату   │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Клиент оплачивает    │
                    │  на странице          │
                    │  платежной системы    │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Webhook от платежной │
                    │  системы (success)    │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Автоматическое       │
                    │  обновление статусов  │
                    │  - Payment: completed │
                    │  - Client: "Куплена   │
                    │    услуга"            │
                    │  - Генерация полной   │
                    │    программы          │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Автоматическая выдача│
                    │  платной программы    │
                    │  клиенту (PDF)        │
                    └───────────┬───────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│              ЭТАП 4: ПОСТПРОДАЖНОЕ ОБСЛУЖИВАНИЕ                              │
│                    Работа с активными клиентами                              │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────────┐
                    │  Клиент перемещается  │
                    │  в этап "Активный     │
                    │  клиент"              │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Система напоминаний  │
                    │  - Регулярные         │
                    │    напоминания через  │
                    │    бота               │
                    │  - Мотивационные      │
                    │    сообщения          │
                    │  - Чек-ины прогресса  │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Мониторинг активности│
                    │  - Отслеживание       │
                    │    взаимодействий     │
                    │  - Аналитика          │
                    │    использования      │
                    │    программы          │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Upsell возможности   │
                    │  - Переход на 3 мес.  │
                    │  - План питания       │
                    │  - Доп. услуги        │
                    └───────────┬───────────┘
                                │
                    ┌───────────▼───────────┐
                    │  Завершение программы │
                    │  - Перемещение в      │
                    │    этап "Завершен"    │
                    │  - Сбор фидбека       │
                    │  - Предложение        │
                    │    следующего пакета  │
                    └───────────────────────┘
```

---

## Компоненты системы и их взаимодействие

```
┌─────────────────────────────────────────────────────────────────────┐
│                         АРХИТЕКТУРА СИСТЕМЫ                             │
└─────────────────────────────────────────────────────────────────────┘

┌──────────────┐        ┌──────────────┐        ┌──────────────┐
│   Клиент     │        │   Тренер     │        │ Администратор│
│   (Пользователь)      │ (Владелец)   │        │  (CRM)       │
└──────┬───────┘        └──────┬───────┘        └──────┬───────┘
       │                       │                       │
       │                       │                       │
       ▼                       ▼                       ▼
┌───────────────────────────────────────────────────────────────────────┐
│                      ТОЧКИ КОНТАКТА С КЛИЕНТОМ                         │
│                                                                       │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐           │
│  │   Сайт       │    │ Telegram-бот │    │ LLM-чат на   │           │
│  │              │    │              │    │   сайте      │           │
│  │ - Форма      │    │ - Опросник   │    │              │           │
│  │ - Виджет чата│    │ - Выдача     │    │ - Квалификация│          │
│  │ - Онлайн-оплата│  │   программ   │    │ - Ответы на  │           │
│  │              │    │ - FAQ        │    │   вопросы    │           │
│  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘           │
│         │                   │                   │                    │
└─────────┼───────────────────┼───────────────────┼────────────────────┘
          │                   │                   │
          └───────────────────┴───────────────────┘
                              │
                              ▼
┌───────────────────────────────────────────────────────────────────────┐
│                        CRM API (FastAPI)                               │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  REST API Endpoints                                          │   │
│  │  - /api/clients          (CRUD клиентов)                     │   │
│  │  - /api/leads            (Управление лидами)                 │   │
│  │  - /api/payments         (Платежи и webhook)                 │   │
│  │  - /api/programs         (Программы тренировок)              │   │
│  │  - /api/pipeline         (Воронка продаж)                    │   │
│  │  - /api/website-settings (Настройки сайта)                   │   │
│  │  - /api/social-posts     (Публикации в соцсетях)             │   │
│  │  - /api/promocodes       (Промокоды и скидки)                │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  Бизнес-логика                                              │   │
│  │  - Создание/обновление клиентов                             │   │
│  │  - Движение по воронке                                      │   │
│  │  - Обработка платежей                                       │   │
│  │  - Генерация программ                                       │   │
│  │  - Интеграции с внешними сервисами                          │   │
│  └──────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                     СЕРВИСЫ И ИНТЕГРАЦИИ                               │
│                                                                       │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │
│  │  Генератор       │  │  LLM Сервис      │  │  Платежные       │  │
│  │  программ        │  │                  │  │  системы         │  │
│  │                  │  │  - Yandex GPT    │  │  - YooKassa        │  │
│  │  - Поиск в       │  │  - OpenAI        │  │  - Tinkoff       │  │
│  │    Google Sheets │  │  - ProxyAPI      │  │                  │  │
│  │  - Форматирование│  │                  │  │  - Webhook       │  │
│  │  - PDF генерация │  │  - Чат-виджет    │  │    обработка     │  │
│  └──────────────────┘  │  - Форматирование│  └──────────────────┘  │
│                        │    программ      │                          │
│                        └──────────────────┘                          │
│                                                                       │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │
│  │  Уведомления     │  │  Соцсети         │  │  Программы       │  │
│  │                  │  │                  │  │  хранения        │  │
│  │  - Telegram бот  │  │  - Telegram канал│  │                  │  │
│  │  - Email (планир.)│  │  - VK паблик    │  │  - Сохранение    │  │
│  │                  │  │  - Instagram     │  │  - Выдача        │  │
│  │  - Администратору│  │    (планир.)     │  │  - История       │  │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘  │
└───────────────────────────────────┬───────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                         БАЗА ДАННЫХ (SQLite)                           │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  Основные таблицы                                            │   │
│  │  - clients          (Клиенты)                                │   │
│  │  - leads            (Лиды)                                   │   │
│  │  - payments         (Платежи)                                │   │
│  │  - training_programs (Программы тренировок)                  │   │
│  │  - pipeline_stages  (Этапы воронки)                          │   │
│  │  - client_pipelines (История движений)                       │   │
│  │  - client_actions   (Действия клиентов)                      │   │
│  │  - website_settings (Настройки сайта)                        │   │
│  │  - chat_messages    (История чата LLM)                       │   │
│  │  - social_posts     (Публикации)                             │   │
│  │  - promo_codes      (Промокоды)                              │   │
│  │  - promo_code_usages (Использование промокодов)              │   │
│  └──────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────┐
│                    АДМИН-ПАНЕЛЬ (React)                                │
│                                                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  Страницы управления                                         │   │
│  │  - /clients         (Список клиентов)                        │   │
│  │  - /pipeline        (Воронка продаж)                         │   │
│  │  - /programs        (Программы тренировок)                   │   │
│  │  - /analytics       (Аналитика и метрики)                    │   │
│  │  - /settings        (Настройки системы)                      │   │
│  │  - /website-settings (Настройки сайта и виджета)             │   │
│  │  - /social-posts    (Управление публикациями)                │   │
│  │  - /promocodes      (Управление промокодами)                 │   │
│  └──────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────────────┘
```

---

## Этапы воронки продаж (Pipeline Stages)

Система использует многоэтапную воронку продаж для отслеживания прогресса клиентов:

```
┌───────────────────────────────────────────────────────────────────────┐
│                    ВОРОНКА ПРОДАЖ (ПО УМОЛЧАНИЮ)                       │
└───────────────────────────────────────────────────────────────────────┘

1. ┌──────────────────────┐
   │ Первичный контакт    │ ◄─── Новый лид из бота/сайта
   │ (TOFU)               │
   └──────────┬───────────┘
              │
              ▼ (Автоматически: прохождение опросника)
              
2. ┌──────────────────────┐
   │ Консультация         │ ◄─── Qualified lead
   │ (MOFU)               │      Получена бесплатная программа
   └──────────┬───────────┘
              │
              ▼ (Автоматически: создание платежа)
              
3. ┌──────────────────────┐
   │ Принимают решение    │ ◄─── Клиент рассматривает предложение
   │ (BOFU)               │
   └──────────┬───────────┘
              │
              ▼ (Автоматически: успешная оплата)
              
4. ┌──────────────────────┐
   │ Куплена услуга       │ ◄─── Payment completed
   │ (Платный клиент)     │      Программа выдана
   └──────────┬───────────┘
              │
              ▼ (Автоматически: начало выполнения программы)
              
5. ┌──────────────────────┐
   │ Активный клиент      │ ◄─── Клиент работает по программе
   │ (Работа в процессе)  │
   └──────────┬───────────┘
              │
              ▼ (Автоматически: завершение программы / Ручное)
              
6. ┌──────────────────────┐      ┌──────────────────────┐
   │ Завершен             │      │ Неактивен            │
   │ (Успешное            │      │ (Потерян клиент)     │
   │  завершение)         │      │                      │
   └──────────────────────┘      └──────────────────────┘
```

### Автоматические переходы между этапами

| Событие | Исходный этап | Целевой этап | Условие |
|---------|--------------|--------------|---------|
| Запуск бота `/start` | - | Первичный контакт | Создание нового клиента |
| Завершение опросника | Первичный контакт | Консультация | Получена бесплатная программа |
| Создание платежа | Консультация | Принимают решение | Инициирован платеж |
| Успешная оплата | Принимают решение | Куплена услуга | Payment status = `completed` |
| Выдача программы | Куплена услуга | Активный клиент | Программа отправлена клиенту |
| Завершение программы | Активный клиент | Завершен | Ручное перемещение или автоматическое (по времени) |
| Потеря контакта | Любой | Неактивен | Ручное перемещение администратором |

---

## Потоки данных между компонентами

### 1. Процесс привлечения лида через сайт

```
Клиент (Браузер)
    │
    ├─► Сайт (dnk/)
    │   │
    │   ├─► Заполнение формы обратной связи
    │   │   └─► POST /api/website/contact-form
    │   │       │
    │   │       ▼
    │   │   CRM API
    │   │       │
    │   │       ├─► Создание/обновление Client
    │   │       ├─► Создание Lead
    │   │       ├─► Создание ClientAction
    │   │       └─► Уведомление тренеру (Telegram)
    │   │
    │   ├─► Взаимодействие с LLM-чатом
    │   │   └─► POST /api/chat/message
    │   │       │
    │   │       ▼
    │   │   LLM Сервис (Yandex GPT / OpenAI)
    │   │       │
    │   │       ├─► Обработка запроса
    │   │       ├─► Генерация ответа
    │   │       ├─► Сохранение истории (chat_messages)
    │   │       └─► Возврат ответа клиенту
    │   │
    │   └─► Онлайн-оплата
    │       └─► POST /api/payments/create
    │           │
    │           ▼
    │       CRM API → YooKassa API
    │           │
    │           ├─► Создание платежной сессии
    │           ├─► Получение ссылки на оплату
    │           └─► Редирект клиента на страницу оплаты
```

### 2. Процесс квалификации через Telegram-бота

```
Клиент (Telegram)
    │
    ├─► /start команда
    │   │
    │   ▼
    │   Telegram Bot (bot.py)
    │       │
    │       ├─► Создание/поиск Client в CRM
    │       ├─► Приветственное сообщение
    │       └─► Главное меню
    │
    ├─► Выбор "Получить бесплатную программу"
    │   │
    │   ▼
    │   Опросник (handlers/questionnaire.py)
    │       │
    │       ├─► Сбор данных (пол, возраст, опыт, цель и т.д.)
    │       ├─► Сохранение в CRM (Client + Lead)
    │       ├─► Перемещение в этап "Консультация"
    │       │
    │       ▼
    │   Генерация программы
    │       │
    │       ├─► Поиск программы в Google Sheets
    │       │   (services/training_program_generator.py)
    │       │
    │       ├─► Форматирование через LLM
    │       │   (services/program_formatter.py)
    │       │
    │       ├─► Генерация PDF
    │       │   (services/pdf_generator.py)
    │       │
    │       ├─► Сохранение в БД (training_programs)
    │       └─► Отправка клиенту в Telegram
```

### 3. Процесс оплаты и выдачи программы

```
Клиент оплачивает через сайт/бот
    │
    ├─► Выбор тарифа
    │   │
    │   ▼
    │   POST /api/payments/create
    │       │
    │       ▼
    │   CRM API
    │       │
    │       ├─► Создание Payment (status: pending)
    │       ├─► Запрос к YooKassa API
    │       │   └─► Получение ссылки на оплату
    │       └─► Возврат ссылки клиенту
    │
    ├─► Клиент переходит на страницу оплаты YooKassa
    │   │
    │   ├─► Ввод данных карты
    │   ├─► Подтверждение оплаты
    │   └─► YooKassa обрабатывает платеж
    │
    ▼
Webhook от YooKassa
    │
    ├─► POST /api/payments/webhook/yookassa
    │       │
    │       ▼
    │   CRM API (обработка webhook)
    │       │
    │       ├─► Проверка подписи (безопасность)
    │       ├─► Обновление Payment (status: completed)
    │       ├─► Перемещение клиента в этап "Куплена услуга"
    │       │
    │       ▼
    │   Автоматическая генерация полной программы
    │       │
    │       ├─► Генерация программы (12 недель)
    │       ├─► Форматирование через LLM
    │       ├─► Создание PDF
    │       ├─► Сохранение в БД (type: paid)
    │       └─► Отправка клиенту:
    │           ├─► В Telegram (если оплата через бота)
    │           └─► Email (планируется)
    │
    ▼
Клиент перемещается в этап "Активный клиент"
    │
    └─► Система напоминаний запускается автоматически
```

---

## Автоматизации и триггеры

### Автоматические процессы

1. **Создание клиента при первом контакте**
   - Триггер: Команда `/start` в боте или заполнение формы на сайте
   - Действие: Создание записи Client, Lead, перемещение в этап "Первичный контакт"

2. **Квалификация лида**
   - Триггер: Завершение опросника
   - Действие: Обновление Lead (status: qualified), перемещение в этап "Консультация"

3. **Генерация и выдача программы**
   - Триггер: Завершение опросника (бесплатная) или успешная оплата (платная)
   - Действие: Поиск программы → Форматирование → PDF → Отправка клиенту

4. **Обработка платежей**
   - Триггер: Webhook от YooKassa с событием `payment.succeeded`
   - Действие: Обновление Payment, перемещение в этап "Куплена услуга", выдача программы

5. **Перемещение по воронке**
   - Триггер: Различные события (завершение опросника, оплата и т.д.)
   - Действие: Автоматическое перемещение в соответствующий этап, запись в историю

6. **Система напоминаний**
   - Триггер: Периодическая проверка (каждые 5 минут) статусов клиентов
   - Действие: Отправка напоминаний клиентам, которые не перешли на следующий этап

7. **Публикация постов в соцсетях**
   - Триггер: Планировщик (каждые 10 минут) проверяет запланированные посты
   - Действие: Автоматическая публикация в Telegram канал / VK паблик

8. **Уведомления администратору**
   - Триггер: Новое обращение через сайт, создание платежа, вопросы через чат
   - Действие: Отправка уведомления в Telegram администратору

---

## Интеграции с внешними системами

### 1. Google Sheets
- **Назначение**: Хранение шаблонов программ тренировок
- **Метод доступа**: Публичный CSV-экспорт (не требуется авторизация)
- **Использование**: Поиск подходящей программы по параметрам клиента
- **Таблицы**: 
  - Мужские программы: `Men_12w_2`
  - Женские программы: `Women_12w_2`

### 2. YooKassa / Tinkoff (Платежные системы)
- **Назначение**: Обработка онлайн-платежей
- **Интеграция**: REST API для создания платежей, Webhook для получения уведомлений
- **Процесс**:
  1. Создание платежной сессии через API
  2. Редирект клиента на страницу оплаты
  3. Обработка webhook при успешной оплате
  4. Автоматическое обновление статусов в CRM

### 3. LLM провайдеры (Yandex GPT, OpenAI, ProxyAPI)
- **Назначение**: 
  - Чат-виджет на сайте для квалификации и ответов на вопросы
  - Форматирование программ тренировок
- **Настройка**: Через админ-панель (Настройки сайта → Виджет чата)
- **Особенности**: 
  - Настраиваемый системный промпт
  - Сохранение истории диалогов
  - Выбор модели и провайдера

### 4. Telegram
- **Назначение**: 
  - Telegram-бот для взаимодействия с клиентами
  - Уведомления администратору
  - Публикации в канале (автоматизация маркетинга)
- **Компоненты**:
  - Telegram Bot API (через aiogram)
  - Канал для публикаций (опционально)

### 5. VK (ВКонтакте)
- **Назначение**: Автоматическая публикация постов в паблик
- **Интеграция**: VK API (photos.getWallUploadServer, wall.post и т.д.)
- **Статус**: Реализовано, настраивается через админ-панель

### 6. Instagram (планируется)
- **Назначение**: Автоматическая публикация контента
- **Статус**: В планах

### 7. amoCRM (опционально)
- **Назначение**: Альтернативная или дополнительная CRM-система
- **Статус**: Планируется интеграция

---

## Роли участников процесса

### 1. Клиент (End User)
- **Действия**:
  - Посещает сайт или находит бота в соцсетях
  - Заполняет форму или проходит опросник
  - Получает бесплатную программу
  - Оценивает ценность и принимает решение об оплате
  - Оплачивает услугу (через сайт или бота)
  - Получает платную программу
  - Выполняет программу тренировок
  - Взаимодействует с тренером при необходимости

### 2. Тренер (Владелец бизнеса)
- **Действия**:
  - Получает уведомления о новых лидах и обращениях
  - Проводит консультации (при необходимости)
  - Общается с клиентами через Telegram/WhatsApp
  - Принимает ручные платежи (если требуется)
  - Управляет программами тренировок в Google Sheets
  - Анализирует метрики и оптимизирует процесс

### 3. Система (Автоматизация)
- **Действия**:
  - Квалификация лидов
  - Генерация и выдача программ
  - Обработка платежей
  - Перемещение клиентов по воронке
  - Отправка напоминаний
  - Публикация контента в соцсетях
  - Обработка вопросов через LLM-чат

### 4. Администратор CRM
- **Действия**:
  - Управление клиентами через админ-панель
  - Ручное перемещение клиентов по воронке
  - Настройка системы (этапы воронки, промокоды, контент сайта)
  - Управление публикациями в соцсетях
  - Анализ метрик и аналитики
  - Управление промокодами и скидками

---

## Метрики и аналитика

### Ключевые метрики процесса

1. **Метрики привлечения (TOFU)**
   - Количество посетителей сайта
   - Количество запусков бота
   - Источники трафика (соцсети, поиск, прямые переходы)
   - Конверсия: Посетитель → Запуск бота

2. **Метрики квалификации (MOFU)**
   - Количество начавших опросник
   - Количество завершивших опросник
   - Конверсия: Запуск бота → Завершение опросника
   - Среднее время прохождения опросника

3. **Метрики конверсии (BOFU)**
   - Количество созданных платежей
   - Количество успешных оплат
   - Конверсия: Qualified lead → Paying client
   - Средний чек
   - Выбор тарифов (распределение)

4. **Метрики постпродажа**
   - Количество активных клиентов
   - Процент завершивших программу
   - Повторные покупки (upsell)
   - Время в этапе "Активный клиент"
   - NPS (Net Promoter Score)

5. **Общие бизнес-метрики**
   - CAC (Customer Acquisition Cost)
   - LTV (Lifetime Value)
   - ROI (Return on Investment)
   - Маржинальность

### Отчетность

Аналитика доступна в админ-панели на странице `/analytics`:
- Динамика по этапам воронки
- Конверсии между этапами
- Финансовая аналитика (обороты, средний чек)
- Активность клиентов
- Эффективность каналов привлечения

---

## Пояснения к ключевым элементам схемы

### 1. Этап привлечения (TOFU)

**Цель**: Максимизировать количество заинтересованных людей, которые узнают о тренере и его услугах.

**Механика**:
- Публикация контента в соцсетях (посты, истории) с призывом получить бесплатную программу
- Оптимизация сайта для поисковых систем и рекламы
- Реферальная программа (планируется)

**Критерии успеха**: Высокий охват, низкая стоимость привлечения, качественный трафик.

---

### 2. Этап квалификации (MOFU)

**Цель**: Определить целесообразность работы с клиентом, собрать необходимые данные, предоставить ценность (бесплатную программу).

**Механика**:
- Опросник собирает ключевую информацию о клиенте
- Система автоматически подбирает подходящую программу
- Клиент получает ценность (PDF с программой), что повышает доверие

**Критерии успеха**: Высокий процент завершивших опросник, качество собранных данных, удовлетворенность бесплатной программой.

---

### 3. Этап конверсии (BOFU)

**Цель**: Преобразовать qualified lead в paying client.

**Механика**:
- После получения бесплатной программы клиент видит ценность
- Система предлагает платные тарифы
- Упрощенный процесс оплаты (онлайн через сайт или бота)
- Автоматическая выдача программы после оплаты

**Критерии успеха**: Высокая конверсия в оплату, минимальные потери на этапе оплаты, быстрая выдача программы.

---

### 4. Постпродажное обслуживание

**Цель**: Удержать клиента, обеспечить выполнение программы, создать возможность для upsell.

**Механика**:
- Регулярные напоминания и мотивационные сообщения
- Мониторинг активности клиента
- Возможность связи с тренером
- Предложение дополнительных услуг после завершения программы

**Критерии успеха**: Высокий процент завершивших программу, удовлетворенность клиента, повторные покупки.

---

## Сценарии использования

### Сценарий 1: Клиент приходит через сайт

1. Клиент заходит на сайт https://www.batoohan.ru/
2. Видит форму обратной связи или чат-виджет
3. Заполняет форму / общается с чат-ботом
4. Получает пригласительную ссылку в Telegram-бот
5. Переходит в бота, проходит опросник
6. Получает бесплатную программу
7. Видит тарифы и оплачивает через сайт
8. Получает полную программу автоматически

### Сценарий 2: Клиент приходит через соцсети

1. Клиент видит пост в Telegram/VK/Instagram
2. Переходит по ссылке в бота
3. Проходит опросник в боте
4. Получает бесплатную программу
5. Выбирает тариф в боте
6. Оплачивает через бота (или перенаправляется на сайт)
7. Получает полную программу автоматически

### Сценарий 3: Повторный клиент

1. Клиент ранее проходил программу
2. Тренер или система предлагает следующий пакет
3. Клиент выбирает новый тариф (возможно, со скидкой)
4. Оплачивает и получает новую программу
5. Переходит в этап "Активный клиент" снова

---

## Технические особенности

### Обработка ошибок

- **Платежи**: Если webhook не пришел, бот проверяет статус платежей каждые 5 минут
- **Генерация программ**: При ошибке используется резервная программа или уведомление тренеру
- **LLM-чат**: При недоступности LLM возвращается стандартный ответ с предложением связаться с тренером

### Масштабируемость

- **База данных**: SQLite для MVP, возможность перехода на PostgreSQL
- **API**: FastAPI поддерживает асинхронные запросы, готов к горизонтальному масштабированию
- **Контейнеризация**: Docker позволяет легко развертывать на любом сервере

### Безопасность

- **Платежи**: Проверка подписи webhook от YooKassa
- **Данные клиентов**: Хранение в зашифрованной БД, доступ только через API с авторизацией
- **Админ-панель**: Авторизация через токены, защита от CSRF

---

## Заключение

Данная бизнес-архитектура описывает полностью автоматизированную систему продаж фитнес-тренировок, которая:

1. **Автоматизирует** процесс от привлечения до выдачи программы
2. **Масштабируется** и может обрабатывать большое количество клиентов
3. **Интегрируется** с внешними сервисами (платежи, LLM, соцсети)
4. **Отслеживает** весь путь клиента по воронке продаж
5. **Оптимизируется** на основе аналитики и метрик

Система продолжает развиваться и дополняться новыми возможностями (автоматизация маркетинга, интеграция с amoCRM, расширение аналитики).

---

**Дата создания документа**: 2025-01-XX  
**Версия**: 1.0  
**Статус**: Актуальная версия

