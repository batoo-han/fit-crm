# Генерация программ тренировок

## Описание

Система автоматически генерирует персональные программы тренировок на основе данных клиента из Google Sheets.

## Процесс генерации

1. **Сбор данных клиента** (через опросник бота):
   - Пол (мужской/женский)
   - Возраст
   - Опыт тренировок (новичок/средний/продвинутый)
   - Цель (набор массы/похудение/выносливость/общее)
   - Локация (дом/зал)

2. **Поиск программы в Google Sheets**:
   - Система ищет подходящую программу по комбинации параметров
   - Использует таблицы: `Men_12w_2` или `Women_12w_2`
   - При отсутствии точного совпадения выбирает ближайшую программу

3. **Форматирование через LLM**:
   - Программа оформляется в красивый формат
   - Добавляются разделы: заголовок, рекомендации, таблица, контакты, чек-лист

4. **Генерация PDF**:
   - Создается PDF файл с программой
   - Отправляется клиенту в Telegram

## Структура Google Sheets

### Основные листы:
- `Men_12w_2` - программы для мужчин
- `Women_12w_2` - программы для женщин

### Поля таблицы:

**Профильные поля:**
- `Profile` - идентификатор программы (Men_1, Women_2 и т.д.)
- `Age_Group` - возрастная группа (17-25, 26-35 и т.д.)
- `Goal` - цель тренировки (рекомпозиция, набор массы, похудение)
- `Experience` - уровень подготовки (новичок, средний, продвинутый)
- `Location` - место тренировки (дом/зал)

**Структурные поля:**
- `Week` - номер недели (1-12)
- `Day` - номер дня тренировки
- `Microcycle` - тип сплита (FB = фулбоди, UL = верх/низ)
- `Deload` - разгрузочная неделя (0 = обычная, 1 = deload)
- `Session` - название тренировки (Фулбоди A/B/C)

**Поля упражнений (Ex1-Ex5):**
- `Ex[N]_Name` - название упражнения
- `Ex[N]_Sets` - количество подходов
- `Ex[N]_Reps` - количество повторений
- `Ex[N]_Pattern` - паттерн движения
- `Ex[N]_Alt` - альтернативные упражнения
- `Ex[N]_Notes` - технические примечания

## Настройка

### Публичный доступ к Google Sheets

**Не требует credentials.json!** Система использует публичный CSV-экспорт.

1. Убедитесь, что ваши Google Sheets таблицы доступны для чтения всем у кого есть ссылка:
   - Откройте таблицу
   - Нажмите "Настроить доступ"
   - Выберите "Все, у кого есть ссылка" → "Читатель"

2. Добавьте ссылки в `.env`:
   ```env
   TRAINING_PLAN_WOMEN=https://docs.google.com/spreadsheets/d/1RsW_faEZ5y_tYNU3SZtcbFJLgbymAI05LKX8RrI0UYw/edit
   TRAINING_PLAN_MEN=https://docs.google.com/spreadsheets/d/1cjCqIos0QOBH9_-2MiQMCCbV70Ct8qvS50jaBF4_ZPc/edit
   ```

3. Система автоматически извлечет Sheet ID из URL и загрузит данные через CSV.

### Получение Sheet ID

Sheet ID автоматически извлекается из URL таблицы. Если нужно указать напрямую:
```
https://docs.google.com/spreadsheets/d/SHEET_ID_HERE/edit
```

Или используйте переменную `GOOGLE_SHEET_ID` в `.env` (опционально).

## Использование

### Автоматическая генерация

Программа генерируется автоматически после прохождения опросника в боте.

**Система использует публичный CSV-экспорт из Google Sheets.**

Это означает:
- Не нужен credentials.json
- Не нужна настройка Google Cloud Console
- Просто сделайте таблицы публичными для чтения

### Ручная генерация

```python
from services.training_program_generator import program_generator
from services.program_formatter import ProgramFormatter
from services.pdf_generator import PDFGenerator

# Get program data
program_data = program_generator.get_program_from_sheets(
    gender="male",
    age=28,
    experience="intermediate",
    goal="muscle",
    location="зал"
)

# Format program
formatted_program = await ProgramFormatter.format_program(
    program_data=program_data,
    client_name="Иван"
)

# Generate PDF
pdf_path = PDFGenerator.generate_program_pdf(
    program_text=formatted_program,
    client_id=1,
    client_name="Иван"
)
```

## Доработка программ

### Добавление новых программ

1. Откройте Google Sheets таблицу
2. Добавьте новые строки с программами
3. Заполните все необходимые поля
4. Убедитесь, что комбинация параметров уникальна

### Расширение покрытия

Для покрытия всех комбинаций нужно добавить программы:

**Для мужчин:**
- Разные возрастные группы (17-25, 26-35, 36-45, 46-55, 56+)
- Разные цели (рекомпозиция, набор массы, похудение)
- Разные уровни опыта (новичок, средний, продвинутый)
- Разные локации (дом, зал)

**Для женщин:**
- То же самое

### Примеры программ

См. реальные тренировки тренера в документации:
- Мужчины: фулбоди программы, затем сплит верх/низ
- Женщины: акцент на ягодицы и заднюю поверхность бедра

## Формат PDF

PDF включает:
1. Заголовок с именем клиента
2. Введение с описанием программы
3. Основные рекомендации
4. Таблица тренировок по неделям
5. Технические примечания
6. Контакты тренера
7. Чек-лист для тренировок

## Улучшения

### Планируемые улучшения:
1. ✅ Автоматическая генерация из Google Sheets
2. ✅ Форматирование через LLM
3. ✅ Генерация PDF
4. ⏳ Добавление вопроса о локации в опросник
5. ⏳ Расширение покрытия программ
6. ⏳ Учет реальных тренировок тренера
7. ⏳ Прогрессия по неделям
8. ⏳ Система замен упражнений
