# Инструкция по установке и запуску CRM системы

## Предварительные требования

- Python 3.9+
- Установленные зависимости из `requirements.txt`

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Укажите стартовые креденшлы администратора в `.env`:

```env
# CRM Admin (начальные креденшлы)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
ADMIN_EMAIL=admin@fitness.local
```

3. Инициализируйте базу данных CRM:
```bash
python database/init_crm.py
```

Это создаст:
- Все необходимые таблицы в БД
- Этапы воронки продаж по умолчанию
- Пользователя-администратора (логин и пароль из `.env`)

**Если нужно сбросить пароль администратора:**
```bash
python scripts/reset_admin_password.py
```

Этот скрипт обновит пароль администратора на значение из `.env` файла.

**⚠️ ВАЖНО:** После первого входа измените пароль администратора.

## Запуск API

### Режим разработки (с автоперезагрузкой):
```bash
python run_crm_api.py
```

Или через uvicorn напрямую:
```bash
uvicorn crm_api.main:app --reload --host 0.0.0.0 --port 8000
```

Или напрямую из директории проекта:
```bash
python -m uvicorn crm_api.main:app --reload --host 0.0.0.0 --port 8000
```

### Режим продакшена:
```bash
uvicorn crm_api.main:app --host 0.0.0.0 --port 8000 --workers 4
```

API будет доступен по адресу: `http://localhost:8000`

## Документация API

После запуска API доступна интерактивная документация:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## Интеграция с Telegram ботом

### Автоматическое создание записей в CRM

При создании клиента в боте автоматически создается запись в CRM и клиент помещается в этап "Первичный контакт".

### Автоматическое перемещение по воронке

1. **При оплате** - клиент автоматически перемещается в этап "Куплена услуга"
2. **При выдаче программы** - создается запись о назначении программы
3. **При завершении программы** - клиент перемещается в этап "Завершен"

### Webhook для синхронизации

Бот может отправлять webhook запросы в CRM API для синхронизации данных.

## Структура воронки продаж

1. **Первичный контакт** - новый лид из бота/сайта
2. **Консультация** - запланирована/проведена консультация
3. **Принимают решение** - клиент рассматривает предложение
4. **Куплена услуга** - оплата получена, программа выдана
5. **Активный клиент** - клиент выполняет программу
6. **Завершен** - программа завершена
7. **Неактивен** - клиент не отвечает/потерян

## Следующие шаги

1. Создать фронтенд (React приложение)
2. Настроить интеграцию с ботом
3. Добавить функционал дневника параметров в боте
4. Настроить автоматическое сохранение программ для купивших клиентов

